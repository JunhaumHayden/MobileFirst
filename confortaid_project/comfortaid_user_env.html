<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComfortAid √Årea Restrita</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- ... -->
    <link rel="shortcut icon" type="imagex/png" href="/PHP/assets/icon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,300;1,200;1,400&family=Red+Hat+Display:wght@400;500;700&family=Roboto&display=swap"
    rel="stylesheet">
    <!-- ... -->
    <link rel='stylesheet' type='text/css' media='screen' href='./assets/css/style.css'>
    <link rel="shortcut icon" type="imagex/png" href="./assets/img/icone192.png">
    <!-- font-awesome -->
    <link rel='stylesheet' type='text/css' media='screen'         
            href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css'>
     <!-- Bootstrap CSS -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        } */
        .container_inner {
            display: flex;
            justify-content: space-evenly; /* Distribui o espa√ßo entre os filho de maneira igual*/
            flex-wrap: wrap; /* Permite que o flex defina o n√∫mero de elementos por linha*/
            gap: 6rem; /* Define o espa√ßo entre os elementos filhos*/
            padding: 1rem;

            margin-bottom: 5rem;
            background-color: #f5f5f5;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin: 10rem;
            
            /* width: 100%;
            max-width: 400px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
            border-radius: 8px; 
            flex-direction: column;
            align-items: center;
            height: 100vh; */
        }
        .nav-link{
            color: #3160bf;
        }
        .hidden {
            display: none;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .form-group button {
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-group button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <header>
        <h1>üåê ComfortAid üêò</h1>
    </header>
     <!-- barra de navegacao da Aplica√ß√£o -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <!-- Bot√£o do menu de hamb√∫rguer -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Itens do menu -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 bg-light">
                    <li class="nav-item">
                        <a class="nav-link" href="indexx.html">In√≠cio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="navega('home')">Voltar</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tel:+5548988900001">Contato</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Apresentacao da tela -->
    <div class="container_inner">
        <!-- Apresentacao de login -->
        <div id="login-page">
            <h2 class="text-center">Login</h2>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="password">Senha</label>
                <input type="password" id="password" class="form-control" required>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" onclick="login()">Entrar</button>
            </div>
        </div>
    <!-- ####### Apresentacao da area restrita a profissionais ######-->
        <div id="professional-page" class="hidden">
             <!-- Bot√£o para alternar a visibilidade -->
            <!-- Menu de Navega√ß√£o -->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#userNav" aria-controls="userNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="userNav">
                        <div class="navigation d-flex justify-content-around mb-4">
                            <button type="button" class="btn btn-primary" onclick="navega('home')">
                                <i class="fa-solid fa-home"></i> Home
                            </button>
                            <button type="button" class="btn btn-primary" onclick="navega('update-data')">
                                <i class="fa-solid fa-concierge-bell"></i> Atualizar Dados
                            </button>
                            <button type="button" class="btn btn-primary" onclick="navega('new-service')">
                                <i class="fa-solid fa-file"></i> Cadastrar Novo Servi√ßo
                            </button>
                            <button type="button" class="btn btn-primary" onclick="navega('Reviews')">
                                <i class="fa-solid fa-star"></i> Avalia√ß√µes
                            </button>
                            <button type="button" class="btn btn-primary" onclick="logout()">
                                <i class="fa-solid fa-right-from-bracket"></i> Sair
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
             <!-- Elemento que ser√° alternado -->
             <!-- Apresentacao Elemento Home -->
            <div id="home" class="tela show">
                <h3>HOME</h3>
                <h2>Bem-vindo, <span id="professional-name"></span></h2>
                <button class="btn btn-secondary" onclick="navega('update-data')">Atualizar Dados</button>
                <button class="btn btn-secondary" onclick="navega('new-service')">Cadastrar Novo Servi√ßo</button>
                
                <h4>Agendamentos Programados</h4>
                    <div class="row" id="scheduled-appointments"></div>
                    <div id="error-message" class="error-message"></div>
                    <ul id="appointments-list"></ul>
                    <!-- Conte√∫do da p√°gina de apresenta√ß√£o -->
            </div>
            <!-- Apresentacao Elemento Atualizar Dados -->
            <div id="update-data" class="tela collapse">
                <h3>Atualizar Dados</h3>
                    <form id="update-data-form">
                        <fieldset>
                            <legend> 
                                Cadastro de Dados Pessoais
                            </legend>
                            <div class="form-group">
                                <label for="nome">Nome</label>
                                <input type="text" id="nome" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="text" id="email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="senha">Senha</label>
                                <input type="password" id="senha" class="form-control" required>
                            </div>
                            <!-- Campos espec√≠ficos para profissionais -->
                        <div id="profissional-fields" class="hidden">
                            <div class="form-group">
                                <label for="especialidade">Especialidade</label>
                                <input type="text" id="especialidade" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="registro-profissional">Registro Profissional</label>
                                <input type="text" id="registro-profissional" class="form-control">
                            </div>
                        </div>
                        <!-- Campos espec√≠ficos para clientes -->
                        <div id="cliente-fields" class="hidden">
                            <div class="form-group">
                                <label for="cpf">CPF</label>
                                <input type="text" id="cpf" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="nascimento">Data de Nascimento</label>
                                <input type="date" id="nascimento" class="form-control">
                            </div>
                        </div>
                        </fieldset>
                        <fieldset>
                            <legend> 
                                Cadastro de dados de Endere√ßo
                            </legend>
                            <div class="form-group">
                                <label for="telefone">Telefone</label>
                                <input type="text" id="telefone" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="cep">CEP</label>
                                <input type="text" id="cep" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="numero-endereco">N√∫mero</label>
                                <input type="text" id="numero-endereco" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="complemento-endereco">Complemento</label>
                                <input type="text" id="complemento-endereco" class="form-control">
                            </div>
                        </fieldset>
                        <button type="submit" class="btn btn-primary">Atualizar Dados</button>
                        
                        <div class="form-group">
                            <label for="imagem-usuario-input">Imagem de Perfil</label>
                            <input type="file" id="imagem-usuario-input" class="form-control">
                            <button type="button" id="upload-imagem-btn" class="btn btn-secondary">Enviar Imagem</button>
                        </div>
                    </form>
                    <img id="imagem-usuario" src="" alt="Imagem do Usu√°rio" class="img-thumbnail mt-3">
                </div>
                <!-- Formul√°rio para atualizar dados -->
            </div>
            <!-- Apresentacao Elemento Cadastrar Novo Servi√ßo -->
            <div id="new-service" class="tela collapse">
                <h3>Cadastrar Novo Servi√ßo</h3>
                <form id="new-service-form">
                    <div class="form-group">
                        <label for="nome-servico">Nome do Servi√ßo</label>
                        <input type="text" id="nome-servico" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="descricao-servico">Descri√ß√£o</label>
                        <textarea id="descricao-servico" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="preco-servico">Pre√ßo</label>
                        <input type="number" id="preco-servico" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="duracao-servico">Dura√ß√£o (minutos)</label>
                        <input type="number" id="duracao-servico" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="situacao-servico">Situa√ß√£o</label>
                        <select id="situacao-servico" class="form-control" required>
                            <option value="ATIVO">Ativo</option>
                            <option value="INATIVO">Inativo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="data-disponivel-servico">Data Dispon√≠vel</label>
                        <input type="date" id="data-disponivel-servico" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="imagem-servico">Imagem do Servi√ßo</label>
                        <input type="file" id="imagem-servico" class="form-control">
                    </div>
                    <button type="button" class="btn btn-primary" onclick="cadastrarNovoServico()">Cadastrar</button>
                </form>
            </div>
             <!-- Apresentacao de Avaliacoes e parceiros do aplicativo-->
            <div id="Reviews" class="tela collapse">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8">
                        <h3>Avalia√ß√µes</h3>
                        <div id="reviews-list" class="list-group">
                            <!-- Avalia√ß√µes ser√£o carregadas aqui -->
                        </div>
                        </div>
                        <div class="col-md-4">
                        <h4>Links Patrocinados</h4>
                        <div class="list-group">
                            <a href="https://junhaumhayden.github.io/publish/" class="list-group-item list-group-item-action">Landingpage</a>
                            <a href="https://junhaumhayden.github.io/publish/flexturismo.html" class="list-group-item list-group-item-action">FlexTurismo</a>
                            <a href="https://junhaumhayden.github.io/publish/gatinhos.html" class="list-group-item list-group-item-action">Ver Gatinhos Fofinhos</a>
                            <a href="https://arthurs08.github.io/ChefListPrj/" class="list-group-item list-group-item-action">ChefList</a>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>








    <!-- ###### Apresentacao da area restrita a cliente ####### -->
        <div id="cliente-page" class="hidden">
          <!-- Bot√£o para alternar a visibilidade -->
            <!-- Menu de Navega√ß√£o -->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#userNav" aria-controls="userNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="userNav">
                        <div class="navigation d-flex justify-content-around mb-4">
                            <button type="button" class="btn btn-primary" onclick="navega('home-client')">
                                <i class="fa-solid fa-home"></i> Home
                            </button>
                            <button type="button" class="btn btn-primary" onclick="navega('update-data-client')">
                                <i class="fa-solid fa-concierge-bell"></i> Atualizar Dados
                            </button>
                            <!-- <button type="button" class="btn btn-primary" onclick="navega('appointment-history-client')">
                                <i class="fa-solid fa-file"></i> Historico de Agendamentos
                            </button> -->
                            <button type="button" class="btn btn-primary" onclick="navega('Reviews-client')">
                                <i class="fa-solid fa-star"></i> Avalia√ß√µes
                            </button>
                            <button type="button" class="btn btn-primary" onclick="logout()">
                                <i class="fa-solid fa-right-from-bracket"></i> Sair
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Elemento que ser√° alternado -->
            <!-- Apresentacao Elemento Home -->
            <div id="home-client" class="tela show">
                <h3>HOME</h3>
                <h2>Bem-vindo, <span id="cliente-name"></span></h2>
                <button class="btn btn-secondary" onclick="navega('update-data-client')">Atualizar Dados</button>
                <!-- <button class="btn btn-secondary" onclick="navega('new-service')">Consultar Agendamentos</button> -->
                
                <h4>Agendamentos Programados</h4>
                    <div class="row" id="scheduled-appointments-client"></div>
                    <div id="error-message" class="error-message"></div>
                    <!-- Conte√∫do da p√°gina de apresenta√ß√£o -->
            </div>
            <!-- Apresentacao Elemento Atualizar Dados -->
            <div id="update-data-client" class="tela collapse">
                <h3>Atualizar Dados</h3>
                    <form id="update-data-form">
                        <fieldset>
                            <legend> 
                                Cadastro de Dados Pessoais
                            </legend>
                            <div class="form-group">
                                <label for="nome">Nome</label>
                                <input type="text" id="nome" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="text" id="email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="senha">Senha</label>
                                <input type="password" id="senha" class="form-control" required>
                            </div>
                            <!-- Campos espec√≠ficos para profissionais -->
                        <div id="profissional-fields" class="hidden">
                            <div class="form-group">
                                <label for="especialidade">Especialidade</label>
                                <input type="text" id="especialidade" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="registro-profissional">Registro Profissional</label>
                                <input type="text" id="registro-profissional" class="form-control">
                            </div>
                        </div>
                        <!-- Campos espec√≠ficos para clientes -->
                        <div id="cliente-fields" class="hidden">
                            <div class="form-group">
                                <label for="cpf">CPF</label>
                                <input type="text" id="cpf" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="nascimento">Data de Nascimento</label>
                                <input type="date" id="nascimento" class="form-control">
                            </div>
                        </div>
                        </fieldset>
                        <fieldset>
                            <legend> 
                                Cadastro de dados de Endere√ßo
                            </legend>
                            <div class="form-group">
                                <label for="telefone">Telefone</label>
                                <input type="text" id="telefone" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="cep">CEP</label>
                                <input type="text" id="cep" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="numero-endereco">N√∫mero</label>
                                <input type="text" id="numero-endereco" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="complemento-endereco">Complemento</label>
                                <input type="text" id="complemento-endereco" class="form-control">
                            </div>
                        </fieldset>
                        <button type="submit" class="btn btn-primary">Atualizar Dados</button>
                        
                        <div class="form-group">
                            <label for="imagem-usuario-input">Imagem de Perfil</label>
                            <input type="file" id="imagem-usuario-input" class="form-control">
                            <button type="button" id="upload-imagem-btn" class="btn btn-secondary">Enviar Imagem</button>
                        </div>
                    </form>
                    <img id="imagem-usuario" src="" alt="Imagem do Usu√°rio" class="img-thumbnail mt-3">
                </div>
                <!-- Formul√°rio para atualizar dados -->
            </div>
            
            <!-- Apresentacao de Avaliacoes e parceiros do aplicativo-->
            <div id="Reviews-client" class="tela collapse">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8">
                        <h3>Avalia√ß√µes</h3>
                        <div id="reviews-list" class="list-group">
                            <!-- Avalia√ß√µes ser√£o carregadas aqui -->
                        </div>
                        </div>
                        <div class="col-md-4">
                        <h4>Links Patrocinados</h4>
                        <div class="list-group">
                            <a href="https://junhaumhayden.github.io/publish/" class="list-group-item list-group-item-action">Landingpage</a>
                            <a href="https://junhaumhayden.github.io/publish/flexturismo.html" class="list-group-item list-group-item-action">FlexTurismo</a>
                            <a href="https://junhaumhayden.github.io/publish/gatinhos.html" class="list-group-item list-group-item-action">Ver Gatinhos Fofinhos</a>
                            <a href="https://arthurs08.github.io/ChefListPrj/" class="list-group-item list-group-item-action">ChefList</a>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>





        
    </div>
</div>
    <footer>
        <div class="footer-container">
            <div class="logo">
                <img src="/PHP/assets/icons/icon36x36.ico" width="30" alt="Logo">
            </div>
            <div class="info">
                <div>&copy; 2024 HTML / CSS / JavaScript / BootStrap</div>
                <div>Desenvolvido por: Carlos Hayden Junior</div>
            </div>
            <div class="icons">
                <img src="/PHP/assets/icons/icon-html5-48.png" width="20" alt="HTML Icon">
                <img src="/PHP/assets/icons/icon-css3-48.ico" width="20" alt="CSS Icon">
                <img src="/PHP/assets/icons/icons8-js-48.png" width="20" alt="JS Icon">
            </div>
        </div>
        
    </footer>
     <!-- Bootstrap JS (opcional, necess√°rio para funcionalidades como o menu de hamb√∫rguer) -->
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
    // Fun√ß√µes de autentica√ß√£o e sess√£o    
        // Verifica se h√° um usu√°rio logado ao carregar a p√°gina
        document.addEventListener("DOMContentLoaded", function () {
            const user = getSession();
            if (user) {
                redirectToDashboard(user);
            }
        });
        // Salva usu√°rio na sess√£o
        function saveSession(user) {
            sessionStorage.setItem('user', JSON.stringify(user));
        }

        // Recupera usu√°rio da sess√£o
        function getSession() {
            return JSON.parse(sessionStorage.getItem('user'));
        }

        // Apaga a sess√£o (logout)
        function logout() {
            sessionStorage.clear();
             // Redireciona para a p√°gina de login
            document.getElementById('professional-page').classList.add('hidden');
            document.getElementById('cliente-page').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
            window.location.href = "indexx.html";
        }

        // Autentica√ß√£o e redirecionamento
        async function authenticate(email, password) {
            try {
                const response = await axios.post('http://localhost:5000/api/usuarios/login', { email, senha: password });
                const user = response.data;
                if (user) {
                    saveSession(user);
                    redirectToDashboard(user);
                } else {
                    alert('Email ou senha incorretos');
                }
            } catch (error) {
                console.error('Erro ao autenticar:', error);
                alert('Erro ao autenticar. Tente novamente mais tarde.');
            }
        }

        // Redireciona usu√°rio para a √°rea correta
        function redirectToDashboard(user) {
            if (user.tipo === "profissional") {
                // window.location.href = "dashboard-profissional.html";
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('professional-page').classList.remove('hidden');
                document.getElementById('professional-name').textContent = user.nome;
                fetchAppointmentsProfessional(user.id)
            } else if (user.tipo === "cliente") {
                // window.location.href = "dashboard-cliente.html";
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('cliente-page').classList.remove('hidden');
                document.getElementById('cliente-name').textContent = user.nome;
                fetchAppointmentsClient(user.id)
            } else {
                alert("Tipo de usu√°rio inv√°lido");
                logout();
            }
        }
        // Fun√ß√£o para realizar o login
        function login() {
            // Captura o valor do campo de email
            const email = document.getElementById('email').value;
            // Captura o valor do campo de senha
            const password = document.getElementById('password').value;
            // Chama a fun√ß√£o authenticate passando o email e a senha
            authenticate(email, password);
        }
    

        // Fun√ß√µes de navega√ß√£o
        function navega(destino) {
            let telas = document.getElementsByClassName('tela');
            Array.from(telas).forEach(element => {
                element.classList.remove('show');
                element.classList.add('collapse');
            });
            const targetElement = document.getElementById(destino);
            targetElement.classList.remove('collapse');
            targetElement.classList.add('show');

            // Carregar conte√∫do din√¢mico
            if (destino === 'update-data' || destino === 'update-data-client') {
                // loadContent('./assets/forms/update-data.html', 'update-data');
                carregarAtualizarDados();
            } else if (destino === 'appointment-history') {
                // loadContent('./assets/forms/new-service.html', 'new-service');
                carregarDadosAgendamentosCliente();
                
            }
        }
       
    // Fun√ß√µes de carregamento de dados
 
        // Funcao para apresentar a agenda de profissional
        async function fetchAppointmentsProfessional(professionalId) {
            try {
                // Recupera os agendamentos do profissional
                const response = await axios.get(`http://localhost:5000/agendamentos/profissional/${professionalId}`);
                const appointments = response.data;

                // Limpa a lista de agendamentos
                const appointmentsList = document.getElementById('scheduled-appointments');
                appointmentsList.innerHTML = '';

                // Filtros de status
                const statusFilters = {
                    CONFIRMADO: [],
                    CANCELADO: [],
                    PENDENTE: []
                };

                // Organiza os agendamentos por status
                appointments.forEach(appointment => {
                    statusFilters[appointment.status].push(appointment);
                });

                // Cria cards para cada status
                for (const [status, filteredAppointments] of Object.entries(statusFilters)) {
                    if (filteredAppointments.length > 0) {
                        // Cria um container para os agendamentos do status atual
                        const statusContainer = document.createElement('div');
                        statusContainer.classList.add('mb-4');
                        statusContainer.innerHTML = `<h5 class="mb-3">${status}</h5>`;
                        appointmentsList.appendChild(statusContainer);

                        // Cria cards para cada agendamento
                        filteredAppointments.forEach(appointment => {
                            const card = document.createElement('div');
                            card.classList.add('col-md-4', 'mb-3');
                            card.innerHTML = `
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <img src="http://localhost:5000/imagens/usuario/foto/${appointment.cliente.id}" 
                                                alt="${appointment.cliente.nome}" 
                                                class="rounded-circle me-3" 
                                                width="50" 
                                                height="50">
                                            <h6 class="card-title mb-0">${appointment.servico.nome}</h6>
                                        </div>
                                        <p class="card-text">
                                            <strong>Cliente:</strong> ${appointment.cliente.nome}<br>
                                            <strong>Data:</strong> ${new Date(appointment.dataHora).toLocaleString()}
                                        </p>
                                        <button class="btn btn-primary btn-sm" onclick="showAppointmentDetails(${appointment.id})">
                                            Ver Detalhes
                                        </button>
                                    </div>
                                </div>
                            `;
                            statusContainer.appendChild(card);
                        });
                    }
                }
            } catch (error) {
                console.error('Erro ao buscar agendamentos:', error);
                document.getElementById('error-message').innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        Erro ao carregar agendamentos. Tente novamente mais tarde.
                    </div>
                `;
            }
        }

        // Fun√ß√£o para exibir detalhes do agendamento
        async function showAppointmentDetails(appointmentId) {
            try {
                // Recupera os detalhes do agendamento
                const response = await axios.get(`http://localhost:5000/agendamentos/${appointmentId}`);
                const appointment = response.data;

                // Recupera o endere√ßo do cliente usando o CEP
                const cepResponse = await axios.get(`https://viacep.com.br/ws/${appointment.cliente.cep}/json/`);
                const endereco = cepResponse.data;

                // Exibe os detalhes em um modal
                const modalContent = `
                    <div class="modal fade" id="appointmentDetailsModal" tabindex="-1" aria-labelledby="appointmentDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="appointmentDetailsModalLabel">Detalhes do Agendamento</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Servi√ßo</h6>
                                            <p><strong>Nome:</strong> ${appointment.servico.nome}</p>
                                            <p><strong>Descri√ß√£o:</strong> ${appointment.servico.descricao}</p>
                                            <p><strong>Pre√ßo:</strong> R$${appointment.servico.preco}</p>
                                            <p><strong>Dura√ß√£o:</strong> ${appointment.servico.duracao} minutos</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Cliente</h6>
                                            <p><strong>Nome:</strong> ${appointment.cliente.nome}</p>
                                            <p><strong>Nascimento:</strong> ${appointment.cliente.nascimento}</p>
                                            <p><strong>Telefone:</strong> ${appointment.cliente.telefone}</p>
                                            <p><strong>Endere√ßo:</strong> ${endereco.logradouro}, ${appointment.cliente.numeroEndereco}, ${endereco.bairro}, ${endereco.localidade} - ${endereco.uf} - ${appointment.cliente.cep}</p>
                                            <p><strong>Complemento:</strong> ${appointment.cliente.complementoEndereco}</p>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <h6>Mapa</h6>
                                        <iframe 
                                            width="100%" 
                                            height="300" 
                                            style="border:0" 
                                            loading="lazy" 
                                            allowfullscreen 
                                            src="https://www.google.com/maps/embed/v1/place?key=SUA_CHAVE_API&q=${endereco.logradouro},${endereco.bairro},${endereco.localidade}">
                                        </iframe>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                    <button type="button" class="btn btn-primary" onclick="updateAppointmentStatus(${appointment.id}, 'CONFIRMADO')">Confirmar</button>
                                    <button type="button" class="btn btn-warning" onclick="updateAppointmentStatus(${appointment.id}, 'PENDENTE')">Pendente</button>
                                    <button type="button" class="btn btn-danger" onclick="updateAppointmentStatus(${appointment.id}, 'CANCELADO')">Cancelar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Adiciona o modal ao DOM e exibe
                document.body.insertAdjacentHTML('beforeend', modalContent);
                const modal = new bootstrap.Modal(document.getElementById('appointmentDetailsModal'));
                modal.show();
            } catch (error) {
                console.error('Erro ao buscar detalhes do agendamento:', error);
                alert('Erro ao carregar detalhes do agendamento. Tente novamente mais tarde.');
            }
        }

        // Fun√ß√£o para atualizar o status do agendamento
        async function updateAppointmentStatus(appointmentId, status) {
            try {
                const response = await axios.put(`http://localhost:5000/agendamentos/status/${appointmentId}`, {
                    status: status},
                {
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json"
                }
            });

                if (response.status === 200) {
                    alert('Status do agendamento atualizado com sucesso!');
                    fetchAppointmentsProfessional(getSession().id); // Atualiza a lista de agendamentos
                }
            } catch (error) {
                console.error('Erro ao atualizar status do agendamento:', error);
                alert('Erro ao atualizar status. Tente novamente mais tarde.');
            }
        }
        
        // Funcao para apresentar a agenda de cliente
        async function fetchAppointmentsClient(clienteId) {
            // try {
            //     const response = await fetch(`http://localhost:5000/agendamenClient{clienteId}`);
            //     const appointments = await response.json();
            //     const appointmentsList = document.getElementById('appointments-list');
            //     appointmentsList.innerHTML = '';

            //     appointments.forEach(appointment => {
            //         const listItem = document.createElement('li');
            //         listItem.classList.add('appointment-card');
            //         listItem.innerHTML = `
            //             <h4>${appointment.servico.nome}</h4>
            //             <p>Cliente: ${appointment.cliente.nome}</p>
            //             <p>Data: ${new Date(appointment.dataHora).toLocaleString()}</p>
            //         `;
            //         listItem.onclick = () => showAppointmentDetails(appointment);
            //         appointmentsList.appendChild(listItem);
            //     });
            // } catch (error) {
            //     console.error('Erro ao buscar agendamentos:', error);
            //     alert('Erro ao buscar agendamentos. Tente novamente mais tarde.');
            // }
            try {
                // Recupera os agendamentos do cliente
                const response = await axios.get(`http://localhost:5000/agendamentos/cliente/${clienteId}`);
                const appointments = response.data;

                // Limpa a lista de agendamentos
                const appointmentsList = document.getElementById('scheduled-appointments-client');
                appointmentsList.innerHTML = '';

                // Filtros de status
                const statusFilters = {
                    CONFIRMADO: [],
                    CANCELADO: [],
                    PENDENTE: []
                };

                // Organiza os agendamentos por status
                appointments.forEach(appointment => {
                    statusFilters[appointment.status].push(appointment);
                });

                // Cria cards para cada status
                for (const [status, filteredAppointments] of Object.entries(statusFilters)) {
                    if (filteredAppointments.length > 0) {
                        // Cria um container para os agendamentos do status atual
                        const statusContainer = document.createElement('div');
                        statusContainer.classList.add('mb-4');
                        statusContainer.innerHTML = `<h5 class="mb-3">${status}</h5>`;
                        appointmentsList.appendChild(statusContainer);

                        // Cria cards para cada agendamento
                        filteredAppointments.forEach(appointment => {
                            const card = document.createElement('div');
                            card.classList.add('col-md-4', 'mb-3');
                            card.innerHTML = `
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <img src="http://localhost:5000/imagens/usuario/foto/${appointment.servico.profissional.id}" 
                                                alt="${appointment.servico.profissional.nome}" 
                                                class="rounded-circle me-3" 
                                                width="50" 
                                                height="50">
                                            <h6 class="card-title mb-0">${appointment.servico.nome}</h6>
                                        </div>
                                        <p class="card-text">
                                            <strong>Profissional:</strong> ${appointment.servico.profissional.nome}<br>
                                            <strong>Data:</strong> ${new Date(appointment.dataHora).toLocaleString()}
                                        </p>
                                        <button class="btn btn-primary btn-sm" onclick="showAppointmentDetailsClient(${appointment.id})">
                                            Ver Detalhes
                                        </button>
                                    </div>
                                </div>
                            `;
                            statusContainer.appendChild(card);
                        });
                    }
                }
            } catch (error) {
                console.error('Erro ao buscar agendamentos:', error);
                document.getElementById('error-message').innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        Erro ao carregar agendamentos. Tente novamente mais tarde.
                    </div>
                `;
            }
        }
        // Fun√ß√£o para exibir detalhes do agendamento do Cliente
        async function showAppointmentDetailsClient(appointmentId) {
            try {
                // Recupera os detalhes do agendamento
                const response = await axios.get(`http://localhost:5000/agendamentos/${appointmentId}`);
                const appointment = response.data;

                // Recupera o endere√ßo do cliente usando o CEP
                const cepResponse = await axios.get(`https://viacep.com.br/ws/${appointment.servico.profissional.cep}/json/`);
                const endereco = cepResponse.data;

                // Exibe os detalhes em um modal
                const modalContent = `
                    <div class="modal fade" id="appointmentDetailsModal" tabindex="-1" aria-labelledby="appointmentDetailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="appointmentDetailsModalLabel">Detalhes do Agendamento</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Servi√ßo</h6>
                                            <p><strong>Nome:</strong> ${appointment.servico.nome}</p>
                                            <p><strong>Descri√ß√£o:</strong> ${appointment.servico.descricao}</p>
                                            <p><strong>Pre√ßo:</strong> R$${appointment.servico.preco}</p>
                                            <p><strong>Dura√ß√£o:</strong> ${appointment.servico.duracao} minutos</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Profissional</h6>
                                            <p><strong>Nome:</strong> ${appointment.servico.profissional.nome}</p>
                                            <p><strong>Email:</strong> ${appointment.servico.profissional.email}</p>
                                            <p><strong>Telefone:</strong> ${appointment.servico.profissional.telefone}</p>
                                            <p><strong>Endere√ßo:</strong> ${endereco.logradouro}, ${appointment.servico.profissional.numeroEndereco}, ${endereco.bairro}, ${endereco.localidade} - ${endereco.uf} - ${appointment.cliente.cep}</p>
                                            <p><strong>Complemento:</strong> ${appointment.servico.profissional.complementoEndereco}</p>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <h6>Mapa</h6>
                                        <iframe 
                                            width="100%" 
                                            height="300" 
                                            style="border:0" 
                                            loading="lazy" 
                                            allowfullscreen 
                                            src="https://www.google.com/maps/embed/v1/place?key=SUA_CHAVE_API&q=${endereco.logradouro},${endereco.bairro},${endereco.localidade}">
                                        </iframe>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                    <button type="button" class="btn btn-danger" onclick="updateAppointmentStatus(${appointment.id}, 'CANCELADO')">Cancelar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Adiciona o modal ao DOM e exibe
                document.body.insertAdjacentHTML('beforeend', modalContent);
                const modal = new bootstrap.Modal(document.getElementById('appointmentDetailsModal'));
                modal.show();
            } catch (error) {
                console.error('Erro ao buscar detalhes do agendamento:', error);
                alert('Erro ao carregar detalhes do agendamento. Tente novamente mais tarde.');
            }
        }

        // Fun√ß√£o para atualizar os dados
        async function carregarAtualizarDados() {
        const user = getSession();
        if (!user) {
            alert("Usu√°rio n√£o autenticado.");
            return;
        }

        const apiUrl = user.tipo === "profissional" 
            ? `http://localhost:5000/api/usuarios/${user.id}` 
            : `http://localhost:5000/api/usuarios/${user.id}`;

        try {
            const response = await axios.get(apiUrl);
            const userData = response.data;

            // Preencher o formul√°rio com os dados atuais
            document.getElementById('nome').value = userData.nome;
            document.getElementById('email').value = userData.email;
            document.getElementById('senha').value = userData.senha;
            document.getElementById('telefone').value = userData.telefone;
            document.getElementById('cep').value = userData.cep;
            document.getElementById('numero-endereco').value = userData.numeroEndereco;
            document.getElementById('complemento-endereco').value = userData.complementoEndereco;

            if (user.tipo === "profissional") {
                document.getElementById('especialidade').value = userData.especialidade;
                document.getElementById('registro-profissional').value = userData.registroProfissional;
                document.getElementById('profissional-fields').classList.remove('hidden');
            } else if (user.tipo === "cliente") {
                document.getElementById('cpf').value = userData.cpf;
                document.getElementById('nascimento').value = userData.nascimento;
                document.getElementById('cliente-fields').classList.remove('hidden');
            }

            // Exibir a imagem do usu√°rio
            const imagemUsuario = document.getElementById('imagem-usuario');
            imagemUsuario.src = `http://localhost:5000/imagens/usuario/foto/${user.id}`;

            // Anexar listener para o formul√°rio de atualiza√ß√£o
            const updateDataForm = document.getElementById('update-data-form');
            updateDataForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(updateDataForm);
                const data = Object.fromEntries(formData.entries());

                // Comparar os dados atuais com os dados originais
                const updatedData = {};
                for (const key in data) {
                    if (data[key] !== userData[key]) {
                        updatedData[key] = data[key];
                    }
                }

                if (Object.keys(updatedData).length === 0) {
                    alert("Nenhum dado foi alterado.");
                    return;
                }

                try {
                    const updateResponse = await axios.put(apiUrl, updatedData);
                    if (updateResponse.status === 200) {
                        alert('Dados atualizados com sucesso!');
                        saveSession(updateResponse.data); // Atualizar a sess√£o com os novos dados
                    }
                } catch (error) {
                    console.error('Erro ao atualizar dados:', error);
                    alert('Erro ao atualizar dados. Tente novamente mais tarde.');
                }
            });

            // Anexar listener para o bot√£o de upload de imagem
            const uploadImagemBtn = document.getElementById('upload-imagem-btn');
            uploadImagemBtn.addEventListener('click', async () => {
                const imagem = document.getElementById('imagem-usuario-input').files[0];
                if (imagem) {
                    const formData = new FormData();
                    formData.append('file', imagem);

                    try {
                        await axios.post(`http://localhost:5000/imagens/usuario/${user.id}`, formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        alert('Imagem atualizada com sucesso!');
                        imagemUsuario.src = URL.createObjectURL(imagem); // Atualizar a imagem exibida
                    } catch (error) {
                        console.error('Erro ao enviar imagem:', error);
                        alert('Erro ao enviar imagem. Tente novamente mais tarde.');
                    }
                }
            });
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
            alert('Erro ao carregar dados. Tente novamente mais tarde.');
        }
    }

        // Fun√ß√£o para cadastrar um novo servico
        async function cadastrarNovoServico() {
            const user = getSession();
            if (!user || user.tipo !== "profissional") {
                alert("Apenas profissionais podem cadastrar novos servi√ßos.");
                return;
            }

            const nome = document.getElementById('nome-servico').value;
            const descricao = document.getElementById('descricao-servico').value;
            const preco = parseFloat(document.getElementById('preco-servico').value);
            const duracao = parseInt(document.getElementById('duracao-servico').value);
            const situacao = document.getElementById('situacao-servico').value;
            const dataDisponivel = document.getElementById('data-disponivel-servico').value;

            const novoServico = {
                nome: nome,
                descricao: descricao,
                preco: preco,
                duracao: duracao,
                situacao: situacao,
                dataDisponivel: dataDisponivel,
                profissional: {
                    id: user.id
                }
            };

            try {
                const response = await axios.post('http://localhost:5000/servicos', novoServico);
                if (response.status === 201) {
                    alert('Servi√ßo cadastrado com sucesso!');
                    const servicoId = response.data.id;

                    // Upload da imagem do servi√ßo, se houver
                    const imagemServico = document.getElementById('imagem-servico').files[0];
                    if (imagemServico) {
                        const formData = new FormData();
                        formData.append('file', imagemServico);

                        await axios.post(`http://localhost:5000/imagens/servico/${servicoId}`, formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        alert('Imagem do servi√ßo enviada com sucesso!');
                    }

                    // Limpar o formul√°rio ap√≥s o cadastro
                    document.getElementById('new-service-form').reset();
                }
            } catch (error) {
                console.error('Erro ao cadastrar servi√ßo:', error);
                alert('Erro ao cadastrar servi√ßo. Tente novamente mais tarde.');
            }
        }

        // Fun√ß√£o para carregar as avalia√ß√µes
        function carregarAvaliacoes() {
            const apiAvaliacoesUrl = 'http://localhost:5000/avaliacoes';
            axios.get(apiAvaliacoesUrl)
                .then(response => {
                const reviewsList = document.getElementById('reviews-list');
                reviewsList.innerHTML = ''; // Limpa a lista antes de adicionar novos itens
                response.data.forEach(avaliacao => {
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'list-group-item';

                    const reviewContent = `
                    <h5 class="mb-1">${avaliacao.cliente.nome}</h5>
                    <p class="mb-1">${avaliacao.comentario}</p>
                    <small>Nota: ${avaliacao.nota} - Servi√ßo: ${avaliacao.servico.nome}</small>
                    `;

                    reviewItem.innerHTML = reviewContent;
                    reviewsList.appendChild(reviewItem);
                });
                })
                .catch(error => {
                console.error('Erro ao carregar as avalia√ß√µes:', error);
                document.getElementById('reviews-list').innerHTML = 'Ocorreu um erro ao carregar as avalia√ß√µes. Tente novamente mais tarde.';
                });
            }

       // Event listeners
       document.addEventListener('DOMContentLoaded', () => {
            const user = getSession();
            if (user) {
                redirectToDashboard(user);
            }
        });

        document.querySelector('button[onclick="navega(\'update-data\')"]').addEventListener('click', () => navega('update-data'));
        document.querySelector('button[onclick="navega(\'new-service\')"]').addEventListener('click', () => navega('new-service'));
        document.querySelector('button[onclick="navega(\'Reviews\')"]').addEventListener('click', carregarAvaliacoes);

    //     document.querySelector('button[onclick="navega(\'update-data\')"]').addEventListener('click', carregarAtualizarDados);
    //     document.querySelector('button[onclick="navega(\'new-service\')"]').addEventListener('click', cadastrarNovoServico);
    //     document.querySelector('button[onclick="navega(\'Reviews\')"]').addEventListener('click', carregarAvaliacoes);
    // </script>
</body>
</html>